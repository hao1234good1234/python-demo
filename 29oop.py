from datetime import datetime
from typing import Any
from typing import Self


class Contact:
    """
    è”ç³»äººç±»ï¼šå°è£…å§“åã€ç”µè¯ã€åˆ›å»ºæ—¶é—´ç­‰ä¿¡æ¯ã€‚
    æ‰€æœ‰æ•°æ®è®¿é—®å‡é€šè¿‡å±æ€§ç®¡ç†ï¼Œç¡®ä¿æ•°æ®ä¸€è‡´æ€§ä¸å®‰å…¨æ€§ã€‚
    """

    species: str = "Human"  # â† ç±»å±æ€§ï¼šæ‰€æœ‰è”ç³»äººéƒ½æ˜¯äººç±»
    VERSION: str = "1.0"  # â† ç±»å±æ€§

    name: str  # â† å®ä¾‹å±æ€§
    phone: str
    email: str

    # email æ˜¯ä¸€ä¸ªå¯é€‰å‚æ•°ï¼Œç±»å‹æ˜¯å­—ç¬¦ä¸²æˆ–ç©ºå€¼ï¼Œé»˜è®¤ä¸º Noneâ€
    def __init__(
        self, name: str, phone: str | None = None, email: str | None = None
    ) -> None:  # åˆå§‹åŒ–æ–¹æ³•
        # âœ… æ˜¾å¼åˆå§‹åŒ–æ‰€æœ‰å†…éƒ¨å±æ€§ï¼ˆé˜²å¾¡æ€§ç¼–ç¨‹ï¼‰
        self._name = None
        self._phone = None  # â† 1. å…ˆåˆå§‹åŒ–å†…éƒ¨å­˜å‚¨ï¼ˆå—ä¿æŠ¤ï¼‰
        self._email = None
        self._created_at = datetime.now().isoformat()  # â† å†…éƒ¨å­˜å‚¨åˆ›å»ºæ—¶é—´

        # âœ… é€šè¿‡å…¬å…±æ¥å£èµ‹å€¼ï¼ˆè§¦å‘éªŒè¯ï¼‰
        self.name = name  # â† å®ä¾‹å±æ€§ # å…¬æœ‰ï¼šç›´æ¥æš´éœ²
        # ç³»ç»Ÿä¼šè¿™ä¹ˆè¯»å–ï¼šc1.phone = "15699882233", å®ä¾‹c1é‡Œæ²¡æœ‰phoneå±æ€§ï¼Œä½†æ˜¯ç³»ç»Ÿä¸­phoneè¢«@propertyè£…é¥°äº†ï¼Œ
        # phoneä»å±æ€§å˜æˆäº†propertyå¯¹è±¡ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨phoneå¯¹è±¡çš„__set__æ–¹æ³•ï¼Œåˆå› ä¸ºåœ¨ç±»ä¸­å®šä¹‰äº†å¯¹phoneçš„èµ‹å€¼çš„setterè‡ªå®šä¹‰æ–¹æ³•
        # ç³»ç»Ÿä¼šæ‰§è¡Œä½ è‡ªå®šä¹‰çš„setteræ–¹æ³•ï¼š   def phone(self, value) -> self == c1, value == "15699882233"
        self.phone = phone  # â† 2. é€šè¿‡â€œå…¬å…±æ¥å£â€èµ‹å€¼ï¼ˆä¼šè§¦å‘éªŒè¯ï¼ï¼‰
        self.email = email or "123456@qq.com"  # â† å®ä¾‹å±æ€§,é»˜è®¤å€¼æ˜¯ 123456@qq.com

    def __str__(self) -> str:  # â† å®ä¾‹æ–¹æ³•
        return f"{self.name} - {self.phone}"

    def __repr__(self) -> str:  # â† å®ä¾‹æ–¹æ³•
        # Contact(name='Alice', phone='13800138000') åŠ äº†!rä¼šè¾“å‡º''å•å¼•å·ï¼Œæ–¹ä¾¿å¼€å‘äººå‘˜æŸ¥çœ‹
        # Contact(name=Alice, phone=13800138000)  æ²¡æœ‰åŠ !rï¼Œçœ‹ä¸å‡ºæ˜¯å­—ç¬¦ä¸²ï¼
        return f"Contact(name={self.name!r}, phone={self.phone!r})"

    @classmethod  # â† ç±»æ–¹æ³•æ³¨è§£
    def from_dict(cls, data: dict[str, Any]) -> Self:  # â† ç±»æ–¹æ³•ï¼Œè¿”å›è‡ªèº«
        return cls(
            name=data.get("name"),  # â† è·å–å­—å…¸ä¸­çš„nameé”®å¯¹åº”çš„å€¼
            phone=data.get("phone"),
            email=data.get("email")
        )

    @classmethod  # â† ç±»æ–¹æ³•æ³¨è§£
    def get_version(cls) -> str:  # â† ç±»æ–¹æ³•
        return cls.VERSION  # â† é€šè¿‡ cls è®¿é—®ç±»å±æ€§

    @staticmethod  # â† é™æ€æ–¹æ³•æ³¨è§£
    def validate_email(email: str) -> bool:  # â† é™æ€æ–¹æ³•ï¼Œæ²¡æœ‰self
        """éªŒè¯é‚®ç®±æ˜¯å¦åˆæ³•ï¼ˆå·¥å…·å‡½æ•°ï¼‰"""
        return "@" in email

    @staticmethod  # â† é™æ€æ–¹æ³•æ³¨è§£
    def validate_name(name: str) -> bool:  # â† é™æ€æ–¹æ³•ï¼Œæ²¡æœ‰self
        """éªŒè¯å§“åæ˜¯å¦åˆæ³•ï¼ˆå·¥å…·å‡½æ•°ï¼‰"""
        return bool(name.strip())

    @staticmethod  # â† é™æ€æ–¹æ³•æ³¨è§£
    def validate_phone(phone: str) -> bool:  # â† é™æ€æ–¹æ³•ï¼Œæ²¡æœ‰self
        """éªŒè¯ç”µè¯å·ç æ˜¯å¦åˆæ³•ï¼ˆå·¥å…·å‡½æ•°ï¼‰"""
        return bool(isinstance(phone, str) and phone.isdigit() and len(phone) == 11)

    # ===== name å±æ€§ç®¡ç† =====
    @property
    def name(self) -> str:
        """è·å–è”ç³»äººå§“åï¼ˆåªè¯»ï¼Œä¸èƒ½ä¸ºç©ºï¼‰"""
        return self._name

    @name.setter
    def name(self, value: str) -> None:
        if not isinstance(value, str):
            raise ValueError("å§“åå¿…é¡»æ˜¯å­—ç¬¦ä¸²")
        value = value.strip()  # â† å»é™¤å‰åç©ºæ ¼
        if not value:
            raise ValueError("å§“åä¸èƒ½ä¸ºç©º")
        self._name = value

    # ===== phone å±æ€§ç®¡ç† =====
    @property  # â† propertyè£…é¥°å™¨, å°†phoneå±æ€§å˜æˆäº†ä¸€ä¸ªpropertyå¯¹è±¡
    def phone(self) -> str:  # â† getteræ–¹æ³•   # â† è¿™æ˜¯â€œè¯»å–â€æ¥å£
        """è·å–ç”µè¯å·ç ï¼ˆè¿”å› 'æœªè®¾ç½®' æˆ–æœ‰æ•ˆå·ç ï¼‰"""
        return self._phone if self._phone is not None else "æœªè®¾ç½®"  # â† è¯»å–ç§æœ‰å±æ€§

    @phone.setter  # è‡ªå®šä¹‰phoneçš„setteræ–¹æ³•
    def phone(self, value: str) -> None:  # â† setteræ–¹æ³•   # â† è¿™æ˜¯â€œå†™å…¥â€æ¥å£
        """è®¾ç½®ç”µè¯å·ç ï¼ˆå¿…é¡»ä¸º11ä½æ•°å­—å­—ç¬¦ä¸²ï¼‰"""
        if value is None:
            self._phone = None
            return
        if not self._is_valid_phone(value):  # è°ƒç”¨å†…éƒ¨æ–¹æ³•
            raise ValueError("ç”µè¯å¿…é¡»æ˜¯11ä½ï¼Œä¸”åªèƒ½æ˜¯æ•°å­—ï¼")
        self._phone = value

    def _is_valid_phone(self, phone: str) -> bool:  # â† å†…éƒ¨æ–¹æ³•
        """éªŒè¯ç”µè¯å·ç æ˜¯å¦åˆæ³•ï¼ˆå·¥å…·å‡½æ•°ï¼‰"""
        return len(phone) == 11 and phone.isdigit() and isinstance(phone, str)

    @phone.deleter
    def phone(self):  # â† deleteræ–¹æ³•   # â† è¿™æ˜¯â€œåˆ é™¤â€æ¥å£
        """åˆ é™¤ç”µè¯å·ç """
        print("ç”µè¯å·ç å·²åˆ é™¤")
        self._phone = None

    # ===== email å±æ€§ç®¡ç† =====
    @property
    def email(self) -> str:
        return self._email

    @email.setter
    def email(self, value: str):
        if not self._is_valid_email(value):
            raise ValueError("é‚®ç®±æ ¼å¼ä¸æ­£ç¡®ï¼")
        self._email = value

    def _is_valid_email(self, email: str) -> bool:
        return "@" in email and isinstance(email, str)

    # ===== created_at åªè¯»å±æ€§ =====
    @property  # åªæœ‰propertyï¼Œæ²¡æœ‰setterï¼Œåªè¯»
    def created_at(self) -> datetime:  # â† getteræ–¹æ³•   # â† è¿™æ˜¯â€œè¯»å–â€æ¥å£
        """è·å–è”ç³»äººåˆ›å»ºæ—¶é—´ï¼ˆåªè¯»ï¼‰"""
        return self._created_at

    # ===== å…¬å…±æ–¹æ³• =====
    def is_valid(self) -> bool:  # â† å…¬å…±æ¥å£
        """åˆ¤æ–­è”ç³»äººæ˜¯å¦æœ‰æ•ˆï¼ˆå§“åå¿…å¡«ï¼Œç”µè¯å¯é€‰ï¼‰"""
        return self._name is not None

    # ===== è®¡ç®—å±æ€§ =====
    @property
    def full_info(self) -> str:
        return f"{self.name} <{self.phone}>"

    # ====== å¯¹è±¡è½¬æˆå­—å…¸ï¼ˆå¸¸ç”¨äº API è¿”å›ï¼‰ ======
    def to_dict(self) -> dict:
         """å°†è”ç³»äººè½¬ä¸ºå­—å…¸ï¼ˆæ’é™¤ç§æœ‰å±æ€§å’Œæ–¹æ³•ï¼‰"""
         return {
             "name": self.name,
             "phone": self.phone,
             "email": self.email,
             "created_at": self.created_at
         }
    # æˆ–è€…æ›´é€šç”¨çš„åŠ¨æ€æ–¹å¼ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰ï¼š
    def to_dict_dynamic(self) -> dict:
        return {    
            k: v for k, v in self.__dict__.items() 
            # if not k.startswith("_") # æ’é™¤ç§æœ‰å±æ€§
        }
'''
# ç¬¬ä¸€ç« ï¼šOOP åŸºç¡€æ¦‚å¿µ
# ç¬¬äºŒæ­¥ï¼šç±»ï¼ˆClassï¼‰ä¸å¯¹è±¡ï¼ˆObject
'''
# ğŸ’¡ ç±»æœ¬èº«**ä¸å ç”¨å†…å­˜**ï¼Œå®ƒåªæ˜¯â€œè¯´æ˜ä¹¦â€ã€‚åªæœ‰å½“ä½ ç”¨å®ƒé€ å‡ºå¯¹è±¡æ—¶ï¼Œæ‰çœŸæ­£å­˜åœ¨ã€‚
#  ç±»æ˜¯æ¨¡æ¿ï¼Œå¯¹è±¡æ˜¯å®ä¾‹
# âš ï¸ ä¸¥æ ¼è¯´ï¼ŒPython å…ˆè°ƒç”¨ `__new__` åˆ›å»ºå¯¹è±¡ï¼Œå†è°ƒç”¨ `__init__` åˆå§‹åŒ–ã€‚ä½†åˆå­¦è€…å¯ä»¥è®¤ä¸º `__init__` å°±æ˜¯æ„é€ æ–¹æ³•
c1 = Contact("Alice", "13800138000")
c2 = Contact("å°æ˜", "13800138001")
print(c1.name)
print(c2.name)
print(type(c1))
print(c1 is c2)
print(c1.__dict__)
print(c1)

'''
# ç¬¬äºŒç« ï¼šç±»çš„ç»“æ„ä¸æˆå‘˜
# ç¬¬ä¸‰æ­¥ï¼šå®ä¾‹å±æ€§ä¸ç±»å±æ€§
'''

# å®ä¾‹å±æ€§ æ˜¯åœ¨ __init__ï¼ˆæˆ–å…¶ä»–å®ä¾‹æ–¹æ³•ï¼‰ä¸­é€šè¿‡ self.xxx å®šä¹‰çš„å±æ€§ã€‚
# æ¯ä¸ªå¯¹è±¡éƒ½æœ‰è‡ªå·±çš„ä¸€ä»½å‰¯æœ¬ï¼Œäº’ä¸å¹²æ‰°ã€‚

# ç±»å±æ€§ æ˜¯åœ¨ ç±»å†…éƒ¨ã€æ–¹æ³•å¤–éƒ¨ ç›´æ¥å®šä¹‰çš„å˜é‡ã€‚
# å®ƒå±äºç±»æœ¬èº«ï¼Œæ‰€æœ‰å®ä¾‹å…±äº«åŒä¸€ä¸ªå€¼ã€‚

print(c1.species)  # Humanï¼ˆç›´æ¥é€šè¿‡ç±»è®¿é—®ï¼‰
print(c2.species)  # Human
Contact.species = "Person"  # ä¿®æ”¹ç±»å±æ€§
print(c1.species)  # Personï¼ˆæ‰€æœ‰å®ä¾‹éƒ½å˜äº†ï¼ï¼‰
print(c2.species)  # Person

# âœ… æ­£ç¡®åšæ³•ï¼šç±»å±æ€§åº”è¯¥é€šè¿‡ ç±»å ä¿®æ”¹ï¼ˆContact.species = ...ï¼‰ï¼Œè€Œä¸æ˜¯å®ä¾‹ã€‚
#  å¯¹æ¯”æ€»ç»“è¡¨
# | ç‰¹æ€§             | å®ä¾‹å±æ€§                                    | ç±»å±æ€§                                           |
# | ---------------- | ------------------------------------------- | ------------------------------------------------ |
# | **å®šä¹‰ä½ç½®**     | `__init__` æˆ–å®ä¾‹æ–¹æ³•ä¸­ï¼ˆ`self.xxx = ...`ï¼‰ | ç±»å†…éƒ¨ã€æ–¹æ³•å¤–éƒ¨ï¼ˆ`xxx = ...`ï¼‰                  |
# | **å½’å±**         | å±äº**æ¯ä¸ªå¯¹è±¡è‡ªå·±**                        | å±äº**ç±»æœ¬èº«**                                   |
# | **å†…å­˜**         | æ¯ä¸ªå¯¹è±¡ä¸€ä»½                                | æ‰€æœ‰å¯¹è±¡å…±äº«ä¸€ä»½                                 |
# | **ä¿®æ”¹å½±å“**     | åªå½±å“å½“å‰å¯¹è±¡                              | å½±å“æ‰€æœ‰æœªè¦†ç›–è¯¥å±æ€§çš„å¯¹è±¡                       |
# | **è®¿é—®æ–¹å¼**     | `obj.attr`                                  | `ClassName.attr` æˆ– `obj.attr`ï¼ˆä½†ä¸æ¨èç”¨ objï¼‰ |
# | **ä½ çš„é¡¹ç›®ä¾‹å­** | `name`, `phone`, `email`                    | ï¼ˆç›®å‰æ²¡æœ‰ï¼Œä½†å¯ä»¥åŠ  `version = "1.0"`ï¼‰         |

# å±æ€§çš„è®¿é—®ä¸ä¿®æ”¹è§„åˆ™
# | æ“ä½œ             | è¯­æ³•                      | è¯´æ˜                         |
# | ---------------- | ------------------------- | ---------------------------- |
# | **è¯»å–å®ä¾‹å±æ€§** | `obj.name`                | ç›´æ¥è®¿é—®                     |
# | **ä¿®æ”¹å®ä¾‹å±æ€§** | `obj.name = "æ–°åå­—"`     | åªå½±å“è¯¥å¯¹è±¡                 |
# | **è¯»å–ç±»å±æ€§**   | `Contact.VERSION`         | æ¨èç”¨ç±»åè®¿é—®               |
# | **ä¿®æ”¹ç±»å±æ€§**   | `Contact.VERSION = "2.0"` | å½±å“æ‰€æœ‰å®ä¾‹                 |
# | **é”™è¯¯ä¿®æ”¹**     | `obj.VERSION = "2.0"`     | ä¼šåˆ›å»ºå®ä¾‹å±æ€§ï¼Œé®ç›–ç±»å±æ€§ï¼ |


'''
# ç¬¬å››æ­¥ï¼šæ–¹æ³•ï¼ˆMethodsï¼‰ï¼šå®ä¾‹æ–¹æ³•ã€ç±»æ–¹æ³•ã€é™æ€æ–¹æ³•
'''
# 1ï¸âƒ£ å®ä¾‹æ–¹æ³•ï¼ˆInstance Methodï¼‰
# - **æœ€å¸¸è§çš„æ–¹æ³•**
# - ç¬¬ä¸€ä¸ªå‚æ•°å¿…é¡»æ˜¯ `self`ï¼ˆä»£è¡¨å½“å‰å¯¹è±¡ï¼‰
# - å¯ä»¥è®¿é—®å’Œä¿®æ”¹ **å®ä¾‹å±æ€§** å’Œ **ç±»å±æ€§**

print(c1.is_valid())  # True â† è°ƒç”¨å®ä¾‹æ–¹æ³•
print(c1.__str__())

# âœ… **ç‰¹ç‚¹**ï¼šå¿…é¡»é€šè¿‡**å¯¹è±¡**è°ƒç”¨ï¼Œè‡ªåŠ¨ä¼ å…¥ `self`

# 2ï¸âƒ£ ç±»æ–¹æ³•ï¼ˆClass Methodï¼‰â†’ `@classmethod`
# - ç”¨ `@classmethod` è£…é¥°
# - ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ `cls`ï¼ˆä»£è¡¨å½“å‰ç±»ï¼Œä¸æ˜¯å¯¹è±¡ï¼ï¼‰
# - å¯ä»¥è®¿é—® **ç±»å±æ€§**ï¼Œä½†**ä¸èƒ½ç›´æ¥è®¿é—®å®ä¾‹å±æ€§**ï¼ˆå› ä¸ºè¿˜æ²¡åˆ›å»ºå¯¹è±¡ï¼‰

# ğŸ§ª ä½¿ç”¨åœºæ™¯ï¼š**æ›¿ä»£æ„é€ å‡½æ•°**ï¼ˆå·¥å‚æ–¹æ³•ï¼‰
data = {
    "name": "å°æ˜",
    "phone": "15599883377",
    "email": "123456@qq.com"
}
c3 = Contact.from_dict(data)  # â† ä¸ç”¨ä¼  name/phoneï¼Œç›´æ¥ä»å­—å…¸åˆ›å»ºå¯¹è±¡
print(c3.__dict__)

# ğŸ’¡ ä¸ºä»€ä¹ˆä¸ç”¨æ™®é€šå‡½æ•°ï¼Ÿ
# - å®ƒå±äº `Contact` ç±»ï¼Œè¯­ä¹‰æ¸…æ™°
# - å­ç±»ç»§æ‰¿æ—¶ä¼šè‡ªåŠ¨å˜æˆå­ç±»çš„ç±»æ–¹æ³•ï¼ˆå¤šæ€æ”¯æŒï¼‰

# ğŸ§ª ç±»æ–¹æ³•ä¹Ÿèƒ½è®¿é—®ç±»å±æ€§ï¼š
print(Contact.get_version())

# âœ… **ç‰¹ç‚¹**ï¼šé€šè¿‡**ç±»æˆ–å¯¹è±¡**è°ƒç”¨ï¼Œè‡ªåŠ¨ä¼ å…¥ `cls`

# 3ï¸âƒ£ é™æ€æ–¹æ³•ï¼ˆStatic Methodï¼‰â†’ `@staticmethod`
# - ç”¨ `@staticmethod` è£…é¥°
# - **æ²¡æœ‰ `self` æˆ– `cls` å‚æ•°**
# - **ä¸èƒ½è®¿é—®å®ä¾‹å±æ€§æˆ–ç±»å±æ€§**
# - æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ª**æ™®é€šå‡½æ•°**ï¼Œåªæ˜¯é€»è¾‘ä¸Šå±äºè¿™ä¸ªç±»

# print(Contact.validate_phone("13636")) # False
# print(Contact.validate_phone("13800138000")) # True
print(Contact.validate_email("123456@qq.com"))  # True
print(Contact.validate_name("å°æ˜"))  # True

# ğŸ’¡ ä¸ºä»€ä¹ˆä¸ç”¨ç‹¬ç«‹å‡½æ•°ï¼Ÿ
# - è¿™ä¸ªåŠŸèƒ½**å’Œ Contact å¼ºç›¸å…³**ï¼Œæ”¾åœ¨ä¸€èµ·æ›´æ¸…æ™°
# - é¿å…æ±¡æŸ“å…¨å±€å‘½åç©ºé—´
# âœ… **ç‰¹ç‚¹**ï¼šå’Œç±»/å¯¹è±¡æ— å…³ï¼Œåªæ˜¯â€œä½â€åœ¨ç±»é‡Œ

# ğŸ” ä¸‰è€…ç»ˆæå¯¹æ¯”è¡¨
# | ç‰¹æ€§                 | å®ä¾‹æ–¹æ³•                  | ç±»æ–¹æ³• (`@classmethod`)            | é™æ€æ–¹æ³• (`@staticmethod`)         |
# | -------------------- | ------------------------- | ---------------------------------- | ---------------------------------- |
# | **ç¬¬ä¸€ä¸ªå‚æ•°**       | `self`ï¼ˆå¯¹è±¡ï¼‰            | `cls`ï¼ˆç±»ï¼‰                        | æ—                                  |
# | **èƒ½è®¿é—®å®ä¾‹å±æ€§ï¼Ÿ** | âœ… æ˜¯                      | âŒ å¦                               | âŒ å¦                               |
# | **èƒ½è®¿é—®ç±»å±æ€§ï¼Ÿ**   | âœ… æ˜¯                      | âœ… æ˜¯                               | âŒ å¦                               |
# | **è°ƒç”¨æ–¹å¼**         | `obj.method()`            | `Class.method()` æˆ– `obj.method()` | `Class.method()` æˆ– `obj.method()` |
# | **å…¸å‹ç”¨é€”**         | æ“ä½œå¯¹è±¡æ•°æ®              | æ›¿ä»£æ„é€ å‡½æ•°ã€æ“ä½œç±»çŠ¶æ€           | å·¥å…·å‡½æ•°ï¼ˆä¸ç±»ç›¸å…³ä½†ä¸ä¾èµ–çŠ¶æ€ï¼‰   |
# | **ä½ çš„é¡¹ç›®ä¾‹å­**     | `is_valid()`, `__str__()` | `from_dict()`                      | ï¼ˆå¯æ–°å¢ `validate_phone()`ï¼‰      |

# ğŸ’¡ ä½¿ç”¨åœºæ™¯æ€»ç»“ï¼ˆè®°ä½è¿™å‡ å¥ï¼ï¼‰
# - **ç”¨å®ä¾‹æ–¹æ³•**ï¼šå½“ä½ éœ€è¦æ“ä½œ**æŸä¸ªå…·ä½“å¯¹è±¡**çš„æ•°æ®ï¼ˆ90% çš„æƒ…å†µï¼‰
# - **ç”¨ç±»æ–¹æ³•**ï¼šå½“ä½ æƒ³**åˆ›å»ºå¯¹è±¡**ä½†å‚æ•°æ ¼å¼ä¸åŒï¼ˆå¦‚ä» JSONã€å­—å…¸ã€å­—ç¬¦ä¸²åˆ›å»ºï¼‰
# - **ç”¨é™æ€æ–¹æ³•**ï¼šå½“ä½ æœ‰ä¸€ä¸ª**å·¥å…·å‡½æ•°**ï¼Œå’Œç±»ç›¸å…³ä½†ä¸éœ€è¦ç±»æˆ–å¯¹è±¡çš„æ•°æ®

# âœ… å°ç»“ï¼šä¸€å¥è¯åŒºåˆ†
# - **å®ä¾‹æ–¹æ³•**ï¼šæˆ‘è¦æ“ä½œ**æˆ‘è‡ªå·±**ï¼ˆ`self`ï¼‰
# - **ç±»æ–¹æ³•**ï¼šæˆ‘è¦æ“ä½œ**æˆ‘çš„å®¶æ—**ï¼ˆ`cls`ï¼‰
# - **é™æ€æ–¹æ³•**ï¼šæˆ‘åªæ˜¯**ä½åœ¨è¿™å„¿**ï¼Œå’Œä½ ä»¬æ²¡å…³ç³»

'''
# ç¬¬äº”æ­¥ï¼š`self`å‚æ•°è¯¦è§£
'''
# 1ï¸âƒ£ `self` æ˜¯ä»€ä¹ˆï¼Ÿâ€”â€” â€œæˆ‘è‡ªå·±ï¼â€
# **`self` å°±æ˜¯å½“å‰å¯¹è±¡çš„å¼•ç”¨**ã€‚
# å®ƒè®©ä½ åœ¨ç±»çš„æ–¹æ³•é‡Œï¼Œèƒ½è®¿é—®â€œæˆ‘è‡ªå·±â€çš„å±æ€§å’Œæ–¹æ³•ã€‚
# 2ï¸âƒ£ ä¸ºä»€ä¹ˆå¿…é¡»å†™ `self`ï¼Ÿâ€”â€” Python çš„æ˜¾å¼å“²å­¦
# ğŸ Python çš„é€‰æ‹©ï¼š
# **â€œæ˜¾å¼ä¼˜äºéšå¼â€**ï¼ˆZen of Pythonï¼‰
# æ‰€ä»¥ Python **å¼ºåˆ¶ä½ å†™ `self`**ï¼ŒåŸå› æœ‰ä¸‰ï¼š
# | åŸå›           | è¯´æ˜                                                        |
# | ------------- | ----------------------------------------------------------- |
# | **1. æ˜ç¡®æ€§** | ä¸€çœ¼çœ‹å‡ºè¿™æ˜¯å®ä¾‹å±æ€§/æ–¹æ³•ï¼ˆ`self.name` vs æ™®é€šå˜é‡ `name`ï¼‰ |
# | **2. çµæ´»æ€§** | ä½ å¯ä»¥æŠŠæ–¹æ³•å½“æˆæ™®é€šå‡½æ•°è°ƒç”¨ï¼ˆå¦‚ `Contact.is_valid(c)`ï¼‰    |
# | **3. ä¸€è‡´æ€§** | æ‰€æœ‰å®ä¾‹æ–¹æ³•éƒ½ç»Ÿä¸€æ ¼å¼ï¼Œæ²¡æœ‰é­”æ³•                            |
# 3ï¸âƒ£ `self` ä¸å®ä¾‹çš„å…³ç³» â€”â€” â€œæ¯æ¬¡è°ƒç”¨ï¼Œè‡ªåŠ¨ç»‘å®šâ€
# å…³é”®æœºåˆ¶ï¼š
# > å½“ä½ ç”¨ **å¯¹è±¡è°ƒç”¨æ–¹æ³•** æ—¶ï¼ŒPython **è‡ªåŠ¨æŠŠå¯¹è±¡ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ä¼ ç»™æ–¹æ³•**ã€‚
# ğŸ” åº•å±‚è¿‡ç¨‹ï¼ˆä»¥ä½ çš„ä»£ç ä¸ºä¾‹ï¼‰ï¼š
# c = Contact("å¼ ä¸‰", "13800138000")  # åˆ›å»ºå¯¹è±¡ï¼Œc æ˜¯å¯¹è±¡çš„å¼•ç”¨
# result = c.is_valid()              # è°ƒç”¨æ–¹æ³•

# Python å®é™…æ‰§è¡Œçš„æ˜¯ï¼š

# result = Contact.is_valid(c)  # â† æ‰‹åŠ¨ä¼  c ä½œä¸º self

# æ‰€ä»¥æ–¹æ³•å®šä¹‰å¿…é¡»èƒ½æ¥æ”¶è¿™ä¸ªå‚æ•° â†’ è¿™å°±æ˜¯ `self` çš„ç”±æ¥ï¼

# 4ï¸âƒ£ èƒ½ä¸èƒ½ä¸ç”¨ `self`ï¼Ÿâ€”â€” æŠ€æœ¯ä¸Šèƒ½ï¼Œä½†åƒä¸‡åˆ«ï¼
# ğŸ“Œ **è®°ä½ï¼š`self` ä¸æ˜¯è¯­æ³•è¦æ±‚ï¼Œè€Œæ˜¯ç¤¾åŒºå…±è¯†ã€‚éµå®ˆå®ƒï¼Œä½ çš„ä»£ç æ‰â€œPythonicâ€**

# âœ… å°ç»“ï¼šä¸‰å¥è¯è®°ä½ `self`
# 1. **`self` å°±æ˜¯å¯¹è±¡è‡ªå·±**ï¼Œæ˜¯æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°
# 2. **å¿…é¡»å†™**ï¼Œå› ä¸º Python è¦æ˜¾å¼ä¼ é€’å¯¹è±¡å¼•ç”¨
# 3. **åå­—å¯ä»¥æ¢ï¼Œä½†æ°¸è¿œç”¨ `self`**ï¼ˆè¿™æ˜¯ Python çš„ç¤¼ä»ªï¼ï¼‰

"""
# ç¬¬ä¸‰ç« ï¼šå°è£…ï¼ˆEncapsulationï¼‰
# ç¬¬å…­æ­¥ï¼šè®¿é—®æ§åˆ¶
"""
# 1ï¸âƒ£ å°è£…ï¼ˆEncapsulationï¼‰â€”â€” ä¿¡æ¯éšè—çš„è‰ºæœ¯
### âœ… æ ¸å¿ƒæ€æƒ³ï¼š

# > æŠŠå¯¹è±¡çš„**å†…éƒ¨å®ç°ç»†èŠ‚éšè—èµ·æ¥**ï¼Œåªæä¾›**å®‰å…¨çš„å…¬å…±æ¥å£**ä¾›å¤–éƒ¨ä½¿ç”¨ã€‚
# âœ… å¤–éƒ¨ä»£ç åªéœ€è¦è°ƒç”¨ `contact.is_valid()`ï¼Œ**ä¸éœ€è¦çŸ¥é“**ï¼š

# - ç”µè¯æ˜¯ä¸æ˜¯ 11 ä½ï¼Ÿ
# - åå­—æ˜¯ä¸æ˜¯ç©ºï¼Ÿ
# - æœ‰æ²¡æœ‰ç‰¹æ®Šå­—ç¬¦ï¼Ÿ

# > è¿™å°±æ˜¯å°è£…ï¼š**â€œä½ åªç®¡é—®æˆ‘â€˜æ˜¯å¦æœ‰æ•ˆâ€™ï¼Œåˆ«ç®¡æˆ‘æ€ä¹ˆåˆ¤æ–­ï¼â€**
# 2ï¸âƒ£ Python çš„â€œè®¿é—®æ§åˆ¶â€â€”â€” æ²¡æœ‰å¼ºåˆ¶ï¼Œåªæœ‰çº¦å®š
# âš ï¸ **é‡è¦å‰æ**ï¼š

# > **Python æ²¡æœ‰åƒ Java/C++ é‚£æ ·çš„ `private`/`protected` å…³é”®å­—ï¼**
# > æ‰€æœ‰å±æ€§å’Œæ–¹æ³•**é»˜è®¤éƒ½æ˜¯å…¬æœ‰çš„**ï¼ˆpublicï¼‰ã€‚

# ä½† Python ç”¨ **å‘½åçº¦å®š** æ¥è¡¨è¾¾â€œè®¿é—®æ„å›¾â€ï¼š
# | å‘½åæ–¹å¼ | å«ä¹‰                | è®¿é—®å»ºè®®                       | ä½ çš„é¡¹ç›®ä¾‹å­       |
# | -------- | ------------------- | ------------------------------ | ------------------ |
# | `name`   | å…¬æœ‰ï¼ˆpublicï¼‰      | âœ… éšä¾¿ç”¨                       | `contact.name`     |
# | `_name`  | å—ä¿æŠ¤ï¼ˆprotectedï¼‰ | âš ï¸ â€œå†…éƒ¨ä½¿ç”¨ï¼Œè¯·å‹¿ç›´æ¥è®¿é—®â€     | `_validate()`      |
# | `__name` | ç§æœ‰ï¼ˆprivateï¼‰     | âŒ â€œå¼ºçƒˆä¸å»ºè®®è®¿é—®â€ï¼ˆä¼šæ”¹åï¼ï¼‰ | `__internal_cache` |

# 3ï¸âƒ£ è¯¦ç»†è§£æï¼š`_` å’Œ `__` çš„åŒºåˆ«
### ğŸ”¹ 3.1 å•ä¸‹åˆ’çº¿ `_xxx` â†’ â€œå—ä¿æŠ¤â€ï¼ˆProtectedï¼‰

# - **ä½œç”¨**ï¼šå‘Šè¯‰å…¶ä»–å¼€å‘è€…ï¼šâ€œè¿™æ˜¯å†…éƒ¨å®ç°ï¼Œæœªæ¥å¯èƒ½å˜ï¼Œåˆ«ä¾èµ–å®ƒâ€
# - **å®é™…æ•ˆæœ**ï¼š**æ²¡æœ‰ä»»ä½•é™åˆ¶**ï¼ä½ ä»ç„¶å¯ä»¥è®¿é—®
# - **from module import \*** æ—¶ä¼šè¢«å¿½ç•¥ï¼ˆä½†ä¸€èˆ¬ä¸ç”¨ `import *`ï¼‰

# ğŸ’¡ **æœ€ä½³å®è·µ**ï¼šç”¨ `_` æ ‡è®°é‚£äº›â€œå¯èƒ½å˜åŒ–â€æˆ–â€œä»…å†…éƒ¨ä½¿ç”¨â€çš„è¾…åŠ©æ–¹æ³•/å±æ€§ã€‚
# âœ… æ”¹è¿›ä½ çš„ä»£ç ï¼ˆå»ºè®®ï¼‰ï¼š
# class Contact:
#     def __init__(self, name, phone):
#         self.name = name
#         self._phone = phone  # â† ç”µè¯åº”å—ä¿æŠ¤ï¼Œé€šè¿‡æ–¹æ³•è®¿é—®

#     @property
#     def phone(self):  # â† å…¬å…±åªè¯»æ¥å£
#         return self._phone

#     @phone.setter
#     def phone(self, value):  # â† å…¬å…±å†™å…¥æ¥å£ï¼ˆå¯åŠ éªŒè¯ï¼‰
#         if not self._validate_phone(value):
#             raise ValueError("æ— æ•ˆç”µè¯")
#         self._phone = value

#     def _validate_phone(self, phone):  # â† å†…éƒ¨æ–¹æ³•
#         return len(phone) == 11 and phone.isdigit()


# è¿™æ ·ï¼š

# - å¤–éƒ¨ç”¨ `c.phone`ï¼ˆåƒå…¬æœ‰å±æ€§ï¼‰
# - å†…éƒ¨ç”¨ `self._phone` å’Œ `self._validate_phone()`
# - æœªæ¥æ”¹éªŒè¯é€»è¾‘ï¼Œä¸å½±å“å¤–éƒ¨ä»£ç 

# ğŸ”¹ 3.2 åŒä¸‹åˆ’çº¿ `__xxx` â†’ â€œç§æœ‰â€ï¼ˆName Manglingï¼‰
# - **ä½œç”¨**ï¼šè§¦å‘ **åç§°æ”¹å†™ï¼ˆName Manglingï¼‰**ï¼Œé¿å…å­ç±»æ„å¤–è¦†ç›–
# - **å®é™…æ•ˆæœ**ï¼š`__xxx` ä¼šè¢«æ”¹åä¸º `_ClassName__xxx`
# - **ä¸æ˜¯çœŸæ­£çš„ç§æœ‰**ï¼åªæ˜¯æ›´éš¾ç›´æ¥è®¿é—®

#### ğŸ§ª å®éªŒï¼š

# class Contact:
#     def __init__(self, name, phone):
#         self.__phone = phone  # â† åŒä¸‹åˆ’çº¿

# c = Contact("å¼ ä¸‰", "13800138000")

# # ç›´æ¥è®¿é—®ä¼šæŠ¥é”™
# # print(c.__phone)  # âŒ AttributeError

# # ä½†ä½ å¯ä»¥è¿™æ ·è®¿é—®ï¼ˆä¸æ¨èï¼ï¼‰
# print(c._Contact__phone)  # âœ… "13800138000" â† åç§°è¢«æ”¹å†™äº†ï¼

# #### ğŸ” æŸ¥çœ‹å¯¹è±¡å†…éƒ¨ï¼š

# print(c.__dict__)
# # è¾“å‡º: {'_Contact__phone': '13800138000'}

# > âœ… **ç”¨é€”**ï¼šå½“ä½ å†™æ¡†æ¶æˆ–åº“ï¼Œ**ç»å¯¹ä¸æƒ³**è®©ç”¨æˆ·/å­ç±»ç¢°åˆ°æŸä¸ªå±æ€§æ—¶ä½¿ç”¨ã€‚

# #### âš ï¸ æ³¨æ„ï¼š

# - ä¸è¦æ»¥ç”¨ `__`ï¼å¤§å¤šæ•°æƒ…å†µ `_` å°±å¤Ÿäº†
# - å®ƒä¸»è¦æ˜¯ä¸º**é¿å…å‘½åå†²çª**ï¼Œä¸æ˜¯ä¸ºäº†â€œå®‰å…¨â€

# 4ï¸âƒ£ ä¸‰ç§æˆå‘˜å¯¹æ¯”æ€»ç»“
# | ç±»å‹                    | å‘½å                   | è®¿é—®æƒé™           | ç”¨é€”         | ä½ çš„é¡¹ç›®å»ºè®®                     |
# | ----------------------- | ---------------------- | ------------------ | ------------ | -------------------------------- |
# | **å…¬æœ‰ï¼ˆPublicï¼‰**      | `name`, `is_valid()`   | âœ… ä»»æ„è®¿é—®         | å¯¹å¤– API     | `name`, `phone`ï¼ˆé€šè¿‡ propertyï¼‰ |
# | **å—ä¿æŠ¤ï¼ˆProtectedï¼‰** | `_name`, `_validate()` | âš ï¸ çº¦å®šä¸è®¿é—®       | å†…éƒ¨å®ç°ç»†èŠ‚ | `_phone`, `_validate_phone()`    |
# | **ç§æœ‰ï¼ˆPrivateï¼‰**     | `__name`               | âŒ åç§°æ”¹å†™åå¯è®¿é—® | é¿å…å­ç±»å†²çª | ä¸€èˆ¬ä¸ç”¨                         |


# ğŸ’¡ å°è£…çš„æœ€ä½³å®è·µï¼ˆç»“åˆä½ çš„é¡¹ç›®ï¼‰
# class Contact:
#     def __init__(self, name, phone):
#         self.name = name          # å…¬æœ‰ï¼šç›´æ¥æš´éœ²
#         self._phone = None        # å—ä¿æŠ¤ï¼šå†…éƒ¨å­˜å‚¨
#         self.phone = phone        # é€šè¿‡ setter éªŒè¯

#     @property
#     def phone(self):
#         return self._phone

#     @phone.setter
#     def phone(self, value):
#         if not self._is_valid_phone(value):
#             raise ValueError("ç”µè¯å¿…é¡»æ˜¯11ä½æ•°å­—")
#         self._phone = value

#     def _is_valid_phone(self, phone):  # â† å†…éƒ¨æ–¹æ³•
#         return phone.isdigit() and len(phone) == 11

#     def is_valid(self):  # â† å…¬å…±æ¥å£
#         return bool(self.name.strip()) and self._phone is not None


# âœ… è¿™æ ·åšçš„å¥½å¤„ï¼š
# 1. **å°è£…éªŒè¯é€»è¾‘**ï¼šå¤–éƒ¨ä¸èƒ½ç›´æ¥æ”¹ `phone` ç»•è¿‡éªŒè¯
# 2. **æ¸…æ™°çš„æ¥å£**ï¼š`c.phone = "123"` ä¼šè‡ªåŠ¨éªŒè¯
# 3. **æ˜“äºæ‰©å±•**ï¼šä»¥ååŠ æ ¼å¼åŒ–ã€åŠ å¯†ç­‰ï¼Œåªéœ€æ”¹å†…éƒ¨

## âœ… å°ç»“ï¼šä¸‰å¥è¯è®°ä½å°è£…

# 1. **Python æ²¡æœ‰çœŸæ­£çš„ç§æœ‰**ï¼Œåªæœ‰å‘½åçº¦å®š
# 2. **`_xxx` = â€œè¯·å‹¿ç›´æ¥è®¿é—®â€**ï¼Œ`__xxx` = â€œæˆ‘çœŸçš„ä¸æƒ³è¢«è®¿é—®ï¼ˆä¼šæ”¹åï¼‰â€
# 3. **å°è£…çš„æ ¸å¿ƒæ˜¯æä¾›å®‰å…¨æ¥å£**ï¼Œè€Œä¸æ˜¯é”æ­»æ•°æ®

# æ­¤æ—¶çš„phoneæ˜¯propertyå¯¹è±¡
print(Contact.phone)
print(c1.phone)  # è¯»å–çš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨ @property è£…é¥°çš„æ–¹æ³•ï¼Œå¯¹è±¡.å±æ€§
c1.phone = "15522990011"  # å†™å…¥çš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨ @phone.setter è£…é¥°çš„æ–¹æ³•
print(c1.phone)

# è¡¥å……ï¼š
# 1ï¸âƒ£ å¦‚ä½•ç”¨ @property å®ç°åªè¯»å±æ€§ï¼Ÿ
# âœ… ä»€ä¹ˆæ˜¯åªè¯»å±æ€§ï¼Ÿ
# å¤–éƒ¨å¯ä»¥è¯»å–ï¼Œä½†ä¸èƒ½ä¿®æ”¹çš„å±æ€§ã€‚

# ğŸ”§ å®ç°æ–¹æ³•ï¼š
# åªå®šä¹‰ @propertyï¼Œä¸å®šä¹‰ @xxx.setter

# ğŸ§ª ä½ çš„é¡¹ç›®å®æˆ˜ï¼šè®© created_at åªè¯»

c = Contact("å¼ ä¸‰", "13800138000")
# è¯»å–çš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨ @property è£…é¥°çš„æ–¹æ³•ï¼Œå¯¹è±¡.å±æ€§(ç›´æ¥è®¿é—®created_atåå­—ï¼Œä¸éœ€è¦åŠ æ‹¬å·)
print(c.created_at)  # âœ… å¯ä»¥è¯»ï¼š2025-10-06 15:30:45.123456
# c.created_at = "2020-01-01"  # âŒ æŠ¥é”™ï¼
# ğŸ’¡ å…¶ä»–åªè¯»å±æ€§åœºæ™¯ï¼ˆä½ çš„é¡¹ç›®ä¸­ï¼‰ï¼š
# | å±æ€§                        | ä¸ºä»€ä¹ˆåªè¯»ï¼Ÿ                                   |
# | --------------------------- | ---------------------------------------------- |
# | `id`                        | æ•°æ®åº“ä¸»é”®ï¼Œä¸åº”è¢«ä¿®æ”¹                         |
# | `created_at` / `updated_at` | æ—¶é—´æˆ³ï¼Œåº”ç”±ç³»ç»Ÿè‡ªåŠ¨ç®¡ç†                       |
# | `full_info`                 | è®¡ç®—å±æ€§ï¼ˆå¦‚ `"å¼ ä¸‰ <138...>"`ï¼‰ï¼Œä¸åº”ç›´æ¥èµ‹å€¼ |

# ä¾‹å­ï¼šè®¡ç®—å‹åªè¯»å±æ€§
c3 = Contact("lisi", "13800138000")
# è¯»å–çš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨ @property è£…é¥°çš„æ–¹æ³•ï¼Œå¯¹è±¡.å±æ€§(ç›´æ¥è®¿é—®full_infoåå­—ï¼Œä¸éœ€è¦åŠ æ‹¬å·)
print(c3.full_info)  # âœ… å¯ä»¥è¯»ï¼šlisi <13800138000>

# 2ï¸âƒ£ å¦‚ä½•é¿å… setter æ— é™é€’å½’ï¼Ÿ
### â“ ä»€ä¹ˆæ˜¯ setter æ— é™é€’å½’ï¼Ÿ


# å½“ä½ åœ¨ setter é‡Œ**ä¸å°å¿ƒåˆç»™è‡ªå·±èµ‹å€¼**ï¼Œå°±ä¼šä¸æ–­è°ƒç”¨è‡ªå·±ï¼Œç›´åˆ°æ ˆæº¢å‡ºã€‚
# ğŸš« é”™è¯¯ç¤ºèŒƒï¼ˆä½ ç»å¯¹ä¼šé‡åˆ°ï¼ï¼‰ï¼š
class Contact1:
    @property
    def phone(self):
        return self.phone  # âŒ é”™ï¼è¯»å–æ—¶åˆè§¦å‘ property â†’ æ— é™é€’å½’ï¼

    @phone.setter
    def phone(self, value):
        self.phone = value  # âŒ é”™ï¼èµ‹å€¼æ—¶åˆè§¦å‘ setter â†’ æ— é™é€’å½’ï¼


# è¿è¡Œä»»ä¸€éƒ½ä¼šæŠ¥é”™ï¼š
# RecursionError: maximum recursion depth exceeded
### âœ… æ­£ç¡®åšæ³•ï¼š**ç”¨ä¸åŒçš„å†…éƒ¨å±æ€§åå­˜å‚¨æ•°æ®**

#### åŸåˆ™ï¼š


# > **property çš„åå­—ï¼ˆå¦‚ `phone`ï¼‰â‰  å†…éƒ¨å­˜å‚¨çš„åå­—ï¼ˆå¦‚ `_phone`ï¼‰**
# ğŸ”§ æ­£ç¡®ä»£ç æ¨¡æ¿ï¼š
class Contact2:
    def __init__(self, name, phone):
        self._phone = None  # â† å†…éƒ¨å­˜å‚¨ç”¨ _phone
        self.phone = phone  # â† é€šè¿‡ property èµ‹å€¼

    @property
    def phone(self):  # è¯»å–æ¥å£
        return self._phone  # â† è¿”å›å†…éƒ¨å±æ€§

    @phone.setter
    def phone(self, value):  # å†™å…¥æ¥å£
        # åœ¨è¿™é‡ŒåšéªŒè¯ã€æ—¥å¿—ç­‰
        if not value.isdigit():
            raise ValueError("ç”µè¯å¿…é¡»æ˜¯æ•°å­—")
        self._phone = value  # â† å­˜åˆ°å†…éƒ¨å±æ€§ï¼Œä¸å†è§¦å‘ setterï¼


### ğŸ§  ä¸ºä»€ä¹ˆè¿™æ ·å°±å®‰å…¨ï¼Ÿ

# - `self.phone = ...` â†’ è§¦å‘ setter â†’ æ‰§è¡Œ `self._phone = ...`
# - `self._phone` æ˜¯**æ™®é€šå±æ€§**ï¼Œèµ‹å€¼ä¸ä¼šè§¦å‘ä»»ä½•æ–¹æ³•
# - **æ²¡æœ‰å¾ªç¯è°ƒç”¨**ï¼

# ğŸ›  å‘½åå»ºè®®ï¼ˆè¡Œä¸šæƒ¯ä¾‹ï¼‰ï¼š
# | ç”¨é€”               | å‘½åæ–¹å¼ | ä¾‹å­      |
# | ------------------ | -------- | --------- |
# | å…¬å…±å±æ€§æ¥å£       | `xxx`    | `phone`   |
# | å†…éƒ¨å­˜å‚¨           | `_xxx`   | `_phone`  |
# | ç§æœ‰å­˜å‚¨ï¼ˆæå°‘è§ï¼‰ | `__xxx`  | `__phone` |

# âœ… **æ°¸è¿œä¸è¦åœ¨ property çš„ getter/setter é‡Œä½¿ç”¨å’Œ property åŒåçš„å±æ€§ï¼**

# ğŸ§ª ç»¼åˆå®æˆ˜ï¼šå®‰å…¨çš„ Contact ç±»

# from datetime import datetime

# class Contact:
#     def __init__(self, name, phone):
#         self.name = name
#         self._phone = None
#         self.phone = phone          # è§¦å‘ setter éªŒè¯
#         self._created_at = datetime.now()

#     @property
#     def phone(self):
#         return self._phone

#     @phone.setter
#     def phone(self, value):
#         if not (isinstance(value, str) and value.isdigit() and len(value) == 11):
#             raise ValueError("ç”µè¯å¿…é¡»æ˜¯11ä½æ•°å­—å­—ç¬¦ä¸²")
#         self._phone = value

#     @property
#     def created_at(self):  # åªè¯»
#         return self._created_at

#     @property
#     def full_info(self):   # åªè¯»è®¡ç®—å±æ€§
#         return f"{self.name} <{self.phone}>"

# âœ… æµ‹è¯•æ‰€æœ‰åŠŸèƒ½ï¼š
c = Contact("ç‹äº”", "13500135000")
print(c.full_info)  # "ç‹äº” <13500135000>"
print(c.created_at)  # 2025-10-06 15:40:00.123456

c.phone = "13600136000"  # âœ… å¯ä¿®æ”¹ï¼ˆç»è¿‡éªŒè¯ï¼‰
print(c.phone)  # "13600136000"

# âœ… å°ç»“ï¼šä¸¤å¥è¯è®°ä½
# 1. **åªè¯»å±æ€§**ï¼šåªå†™ `@property`ï¼Œä¸å†™ `@xxx.setter`
# 2. **é¿å…é€’å½’**ï¼šproperty ç”¨ `xxx`ï¼Œå†…éƒ¨å­˜å‚¨ç”¨ `_xxx`ï¼ˆåå­—å¿…é¡»ä¸åŒï¼ï¼‰

"""
ç¬¬ä¸ƒæ­¥ï¼šå±æ€§ç®¡ç†
"""
# 1. **ä¸ºä»€ä¹ˆéœ€è¦ propertyï¼Ÿ** â†’ ç”¨æ–¹æ³•æ§åˆ¶å±æ€§è®¿é—®ï¼Œä½†ä¿æŒç‚¹å·è¯­æ³•
# 2. **`@property`** â†’ å®šä¹‰ getterï¼ˆè¯»å–ï¼‰
# 3. **`@<name>.setter`** â†’ å®šä¹‰ setterï¼ˆå†™å…¥ï¼‰
# 4. **`@<name>.deleter`** â†’ å®šä¹‰ deleterï¼ˆåˆ é™¤ï¼‰
# 5. **ä¸‰è€…å¦‚ä½•ååŒå·¥ä½œï¼Ÿ**

# 2ï¸âƒ£ ä¸‰ä½ä¸€ä½“ï¼šgetter / setter / deleter
# ğŸ”§ å®Œæ•´æ¨¡æ¿ï¼ˆè®°ä½è¿™ä¸ªç»“æ„ï¼ï¼‰ï¼š

# class MyClass:
#     def __init__(self, value):
#         self.my_attr = value  # â† è§¦å‘ setter

#     @property
#     def my_attr(self):                # â† getter
#         """è¯»å– my_attr"""
#         return self._my_attr

#     @my_attr.setter
#     def my_attr(self, value):         # â† setter
#         """è®¾ç½® my_attrï¼ˆå¯åŠ éªŒè¯ï¼‰"""
#         self._my_attr = value

#     @my_attr.deleter
#     def my_attr(self):                # â† deleter
#         """åˆ é™¤ my_attr"""
#         self._my_attr = None
#         # æˆ– del self._my_attr


# ğŸ“Œ **å…³é”®**ï¼šä¸‰ä¸ªæ–¹æ³•**å¿…é¡»åŒå**ï¼Œä¸”éƒ½ç”¨ `@property`ã€`@name.setter`ã€`@name.deleter` è£…é¥°

# 3ï¸âƒ£ ä½ çš„ Contact ç±»å®æˆ˜ï¼šå®Œæ•´å±æ€§ç®¡ç†
from datetime import datetime


class Contact_Demo:
    # â€œphone æ˜¯ä¸€ä¸ªå¯é€‰å‚æ•°ï¼Œç±»å‹æ˜¯å­—ç¬¦ä¸²æˆ–ç©ºå€¼ï¼Œé»˜è®¤ä¸º Noneâ€
    def __init__(
        self, name: str, phone: str | None = None, created_at: str | None = None
    ) -> None:
        self.name = name
        self.phone = phone  # è§¦å‘ setter éªŒè¯, è¿™é‡Œä¸åˆ›å»º_phone, setterçš„æ—¶å€™ä¼šåˆ›å»º
        self._created_at = datetime.now()

    @property
    def phone(self) -> str:
        """è¯»å–ç”µè¯å·ç """
        if not self._phone:
            return "æœªè®¾ç½®"
        return self._phone

    @phone.setter
    def phone(self, value: str) -> None:  # setteræ–¹æ³•æ²¡æœ‰è¿”å›å€¼
        """è®¾ç½®ç”µè¯å·ç ï¼ˆå¯åŠ éªŒè¯ï¼‰"""
        if value is None:
            self._phone = None  # â† åˆ›å»º _phone å±æ€§ï¼
            return
        if not (isinstance(value, str) and value.isdigit() and len(value) == 11):
            raise ValueError("æ‰‹æœºå·å¿…é¡»æ˜¯11ä½æ•°å­—å­—ç¬¦ä¸²")
        self._phone = value  # â† åˆ›å»º _phone å±æ€§ï¼

    @phone.deleter
    def phone(self) -> None:
        """åˆ é™¤ç”µè¯å·ç """
        self._phone = None

    @property
    def created_at(self) -> str:
        return self._created_at
        # æ¯æ¬¡è°ƒç”¨éƒ½ä¼šè¿”å›æ–°çš„å½“å‰æ—¶é—´ï¼ˆå¦‚æœå±æ€§ä¸å­˜åœ¨ï¼‰ã€‚ä¸ä¼šç¼“å­˜ï¼
        # return getattr(self, '_created_at', datetime.now())


# 4ï¸âƒ£ æµ‹è¯•æ‰€æœ‰æ“ä½œï¼ˆCRUDï¼‰
contact_Demo = Contact_Demo("å°æ˜")

print(contact_Demo.phone)  # æœªè®¾ç½®

contact_Demo.phone = "13899330022"
print(contact_Demo.phone)  # 13899330022

# æ— æ•ˆèµ‹å€¼ï¼ˆè§¦å‘éªŒè¯ï¼‰
try:
    contact_Demo.phone = "123"
except ValueError as e:
    print(e)  # "æ‰‹æœºå·å¿…é¡»æ˜¯11ä½æ•°å­—å­—ç¬¦ä¸²"

del contact_Demo.phone
print(contact_Demo.phone)  # æœªè®¾ç½®

print(contact_Demo.created_at)  # 2025-10-06 17:52:59.224081

# 5ï¸âƒ£ å…³äº `@<name>.deleter` çš„é‡è¦è¯´æ˜
### â“ ä»€ä¹ˆæ—¶å€™éœ€è¦ deleterï¼Ÿ

# - å½“ä½ å¸Œæœ›æ”¯æŒ `del obj.attr` è¯­æ³•
# - å¹¶ä¸”éœ€è¦**è‡ªå®šä¹‰åˆ é™¤è¡Œä¸º**ï¼ˆå¦‚æ¸…ç†èµ„æºã€è®°å½•æ—¥å¿—ç­‰ï¼‰

### âš ï¸ å¦‚æœæ²¡å®šä¹‰ deleterï¼š

# class Simple:
#     @property
#     def data(self):
#         return self._data

# ä½¿ç”¨
# s = Simple()
# s._data = "hello"
# del s.data  # âŒ AttributeError: can't delete attribute 'data'

### âœ… å¦‚æœå®šä¹‰äº† deleterï¼š

# - `del obj.attr` ä¼šè°ƒç”¨ä½ çš„ deleter æ–¹æ³•
# - ä½ å¯ä»¥åœ¨é‡Œé¢åšä»»ä½•äº‹ï¼ˆè®¾ä¸º Noneã€åˆ é™¤é”®ã€å…³é—­è¿æ¥ç­‰ï¼‰

# 6ï¸âƒ£ é«˜çº§æŠ€å·§ï¼šåŠ¨æ€å±æ€§ or è®¡ç®—å±æ€§
# ğŸ’¡ åœºæ™¯ï¼š`full_name` ç”± `first_name` + `last_name` ç»„æˆ


class Person:
    def __init__(self, first, last):
        self.first_name = first
        self.last_name = last

    @property
    def full_name(self):
        return f"{self.first_name} {self.last_name}"

    @full_name.setter
    def full_name(self, value):
        parts = value.split(" ", 1)
        self.first_name = parts[0]
        self.last_name = parts[1] if len(parts) > 1 else ""


# ä½¿ç”¨
p = Person("å¼ ", "ä¸‰ä¸°")
print(p.full_name)  # å¼  ä¸‰ä¸°
p.full_name = "æ å°é¾™"
print(p.first_name)  # æ
print(p.last_name)  # å°é¾™

# âœ… è¿™å°±æ˜¯ **è®¡ç®—å±æ€§çš„åŒå‘ç»‘å®š**ï¼
# âœ… å°ç»“ï¼šproperty ä¸‰ä»¶å¥—
# | è£…é¥°å™¨          | ä½œç”¨               | æ˜¯å¦å¿…éœ€             | ä½ çš„é¡¹ç›®ç”¨é€”           |
# | --------------- | ------------------ | -------------------- | ---------------------- |
# | `@property`     | å®šä¹‰ getterï¼ˆè¯»ï¼‰  | âœ… å¿…é¡»å…ˆæœ‰å®ƒ         | è¯»å– phoneã€created_at |
# | `@name.setter`  | å®šä¹‰ setterï¼ˆå†™ï¼‰  | âŒ å¯é€‰ï¼ˆåªè¯»å°±ä¸å†™ï¼‰ | éªŒè¯å¹¶è®¾ç½® phone       |
# | `@name.deleter` | å®šä¹‰ deleterï¼ˆåˆ ï¼‰ | âŒ å¯é€‰               | å®‰å…¨åˆ é™¤ phone         |


# ğŸ”‘ **è®°ä½**ï¼š

# - å…ˆæœ‰ `@property`ï¼Œæ‰èƒ½æœ‰ `.setter` å’Œ `.deleter`
# - ä¸‰ä¸ªæ–¹æ³•**å‡½æ•°åå¿…é¡»ç›¸åŒ**
# - å†…éƒ¨å­˜å‚¨ç”¨ `_xxx` é¿å…é€’å½’

'''
# ç¬¬å…«æ­¥ï¼š**`__dict__` ä¸åŠ¨æ€å±æ€§**
'''
# ğŸ’¥ Python çš„å¼ºå¤§ä¹‹å¤„åœ¨äºï¼š**å¯¹è±¡çš„å±æ€§ä¸æ˜¯å›ºå®šçš„ï¼Œå¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€å¢åˆ æ”¹æŸ¥ï¼**  
# è€Œè¿™ä¸€åˆ‡çš„èƒŒåï¼Œå°±æ˜¯ `__dict__` â€”â€” **æ¯ä¸ªå¯¹è±¡çš„â€œå±æ€§ä»“åº“â€**ã€‚

# 1ï¸âƒ£ `__dict__` æ˜¯ä»€ä¹ˆï¼Ÿâ€”â€” å¯¹è±¡çš„â€œå±æ€§ä»“åº“â€
# åœ¨ Python ä¸­ï¼Œ**æ¯ä¸ªå¯¹è±¡ï¼ˆå®ä¾‹ï¼‰é»˜è®¤éƒ½æœ‰ä¸€ä¸ª `__dict__` å±æ€§**ï¼Œå®ƒæ˜¯ä¸€ä¸ªå­—å…¸ï¼ˆ`dict`ï¼‰ï¼Œå­˜å‚¨äº†è¯¥å¯¹è±¡çš„æ‰€æœ‰**å®ä¾‹å±æ€§**ã€‚
print(c1.__dict__)
# {'_name': 'Alice', '_phone': '15522990011', '_email': '123456@qq.com', '_created_at': '2025-10-07T11:57:35.017702'}
# âœ… **`__dict__` å°±æ˜¯å¯¹è±¡æ‰€æœ‰å±æ€§çš„â€œçœŸç›¸â€**ï¼
# 2ï¸âƒ£ ç±»ä¹Ÿæœ‰ `__dict__`ï¼ä½†å†…å®¹ä¸åŒ
print(Contact.__dict__.keys())
# **è¾“å‡º**ï¼ˆéƒ¨åˆ†ï¼‰ï¼š
# dict_keys(['__module__', '__firstlineno__', '__annotations__', '__doc__', 'species', 'VERSION', '__init__', '__str__', '__repr__', 'from_dict', 'get_version', 'validate_email', 'validate_name', 'validate_phone', 'name', 'phone', '_is_valid_phone', 'email', '_is_valid_email', 'created_at', 'is_valid', 'full_info', '__static_attributes__', '__dict__', '__weakref__'])
# âš ï¸ æ³¨æ„ï¼š  
# - **ç±»çš„ `__dict__` å­˜çš„æ˜¯ç±»å±æ€§ã€æ–¹æ³•ã€æè¿°ç¬¦ï¼ˆå¦‚ `@property`ï¼‰**  
# - **å®ä¾‹çš„ `__dict__` å­˜çš„æ˜¯å®ä¾‹å˜é‡ï¼ˆå¦‚ `_name`ï¼‰**  
# - `@property` å®šä¹‰çš„ `phone` æ˜¯**ç±»å±æ€§ï¼ˆæè¿°ç¬¦ï¼‰**ï¼Œä¸ä¼šå‡ºç°åœ¨å®ä¾‹çš„ `__dict__` ä¸­ï¼
# 3ï¸âƒ£ åŠ¨æ€æ·»åŠ /ä¿®æ”¹/åˆ é™¤å±æ€§
# Python å…è®¸ä½ åœ¨**è¿è¡Œæ—¶**ç»™å¯¹è±¡æ·»åŠ æ–°å±æ€§ï¼Œå“ªæ€•ç±»å®šä¹‰é‡Œæ²¡æœ‰ï¼
# âœ… åŠ¨æ€æ·»åŠ å±æ€§
print(c1.__dict__)
c1.age = 30    # åŠ¨æ€æ·»åŠ å±æ€§
c1.roles = ["student", "teacher"]  # åŠ¨æ€æ·»åŠ å±æ€§
print(c1.__dict__)  # {'_name': 'Alice', '_phone': '15522990011', '_email': '123456@qq.com', '_created_at': '2025-10-07T11:57:35.017702', 'age': 30, 'roles': ['student', 'teacher']}
# âœ… åŠ¨æ€ä¿®æ”¹
c1.age = 66
print(c1.__dict__)  # {'_name': 'Alice', '_phone': '15522990011', '_email': '123456@qq.com', '_created_at': '2025-10-07T11:57:35.017702', 'age': 66, 'roles': ['student', 'teacher']}

# âœ… åŠ¨æ€åˆ é™¤
del c1.age  # åˆ é™¤å±æ€§
del c1.roles
print(c1.__dict__)
print(hasattr(c1, "age"))  # False
print(hasattr(c1, "roles"))  # False

# 4ï¸âƒ£ æ›´å®‰å…¨çš„æ–¹å¼ï¼š`getattr()` / `setattr()` / `delattr()`
# è™½ç„¶å¯ä»¥ç›´æ¥ç”¨ `obj.attr = value`ï¼Œä½†åœ¨**å±æ€§åæ˜¯å˜é‡**æ—¶ï¼Œå¿…é¡»ç”¨å†…ç½®å‡½æ•°ï¼š
# | æ“ä½œ | ç›´æ¥è¯­æ³•           | å‡½æ•°å¼ï¼ˆæ¨èåŠ¨æ€åœºæ™¯ï¼‰          |
# | ---- | ------------------ | ------------------------------- |
# | è¯»å– | `obj.attr`         | `getattr(obj, 'attr', default)` |
# | å†™å…¥ | `obj.attr = value` | `setattr(obj, 'attr', value)`   |
# | åˆ é™¤ | `del obj.attr`     | `delattr(obj, 'attr')`          |

# ğŸ”§ ç¤ºä¾‹ï¼šæ‰¹é‡è®¾ç½®å±æ€§
c5 = Contact("lisi")
# å±æ€§åæ¥è‡ªå¤–éƒ¨ï¼ˆå¦‚é…ç½®æ–‡ä»¶ã€ç”¨æˆ·è¾“å…¥ï¼‰
fields = {"age": 49, "department": "IT"}
for key, value in fields.items():
    setattr(c5, key, value) # åŠ¨æ€è®¾ç½®
print(c5.__dict__)
print(hasattr(c5, "age"))  # True
print(c5.department)  # IT

# ğŸ”’ å®‰å…¨è¯»å–ï¼ˆå¸¦é»˜è®¤å€¼ï¼‰
priority = getattr(c5, "priority", "æ™®é€š") #å¦‚æœæ²¡æœ‰priorityï¼Œè¿”å›"æ™®é€š"
print(priority)
# ğŸ”’ å®‰å…¨åˆ é™¤
delattr(c5, "department")
print(hasattr(c5, "department"))  # False

# 5ï¸âƒ£ åŠ¨æ€å±æ€§ vs `@property`ï¼šè°ä¼˜å…ˆï¼Ÿ
# **å…³é”®è§„åˆ™**ï¼š  
# **å®ä¾‹å±æ€§ï¼ˆåœ¨ `__dict__` ä¸­ï¼‰ä¼šè¦†ç›–åŒåçš„ç±»å±æ€§ï¼ˆåŒ…æ‹¬ `@property`ï¼‰ï¼**
### âš ï¸ å±é™©ç¤ºä¾‹ï¼š

# c = Contact("èµµå…­", "13900139000")
# print(c.phone)  # 13900139000 ï¼ˆé€šè¿‡ @property getterï¼‰

# âŒ é”™è¯¯ï¼šç›´æ¥ç»™ phone èµ‹å€¼ï¼ˆç»•è¿‡ setterï¼ï¼‰
# c.phone = "ç»•è¿‡éªŒè¯çš„åƒåœ¾æ•°æ®"  # â† è¿™ä¼šåˆ›å»ºå®ä¾‹å±æ€§ phoneï¼

# print(c.phone)  # "ç»•è¿‡éªŒè¯çš„åƒåœ¾æ•°æ®" ï¼ˆä¸å†è°ƒç”¨ @propertyï¼ï¼‰
# print(c.__dict__)  # {'_name': ..., '_phone': '13900139000', 'phone': 'ç»•è¿‡éªŒè¯...'}

# ğŸ’¥ **`@property` è¢«â€œé®è”½â€äº†ï¼** å› ä¸ºå®ä¾‹å­—å…¸é‡Œæœ‰äº† `phone`ï¼ŒPython ä¸å†æŸ¥æ‰¾ç±»çš„æè¿°ç¬¦ã€‚

# âœ… æ­£ç¡®åšæ³•ï¼š
# - æ°¸è¿œé€šè¿‡**å…¬å…±æ¥å£**æ“ä½œå±æ€§ï¼ˆå³ `c.phone = ...` ä¼šè°ƒç”¨ setterï¼‰
# - **ä¸è¦**æ‰‹åŠ¨ç»™ `@property` åŒåçš„å±æ€§èµ‹å€¼ï¼ˆé™¤éä½ çŸ¥é“åæœï¼‰

# 6ï¸âƒ£ ä»€ä¹ˆæ—¶å€™ç”¨åŠ¨æ€å±æ€§ï¼Ÿâ€”â€” åœºæ™¯ä¸é™·é˜±
# âœ… æ¨èåœºæ™¯ï¼š
# | åœºæ™¯               | è¯´æ˜                                                         |
# | ------------------ | ------------------------------------------------------------ |
# | **é…ç½®å¯¹è±¡**       | `config.debug = True`ï¼Œå±æ€§åä¸å›ºå®š                          |
# | **ORM / æ•°æ®æ¨¡å‹** | ä»æ•°æ®åº“è¡ŒåŠ¨æ€åˆ›å»ºå¯¹è±¡å±æ€§                                   |
# | **æ’ä»¶ç³»ç»Ÿ**       | è¿è¡Œæ—¶æ³¨å…¥æ–°åŠŸèƒ½                                             |
# | **JSON ååºåˆ—åŒ–**  | æŠŠå­—å…¸è½¬æˆå¯¹è±¡ï¼š`for k, v in data.items(): setattr(obj, k, v)` |
# âŒ é¿å…åœºæ™¯ï¼š
# | åœºæ™¯                 | é£é™©                                     |
# | -------------------- | ---------------------------------------- |
# | **æ›¿ä»£æ˜ç¡®çš„ç±»è®¾è®¡** | å¦‚æœä½ çŸ¥é“å±æ€§åï¼Œå°±è¯¥å†™åœ¨ `__init__` é‡Œ |
# | **ç ´åå°è£…**         | ç»•è¿‡ `@property` çš„éªŒè¯é€»è¾‘              |
# | **å›¢é˜Ÿåä½œ**         | åŠ¨æ€å±æ€§éš¾ä»¥è¢« IDE è¯†åˆ«ï¼Œé™ä½å¯è¯»æ€§      |

# 7ï¸âƒ£ å¦‚ä½•ç¦æ­¢åŠ¨æ€å±æ€§ï¼Ÿâ€”â€” `__slots__`
# å¦‚æœä½ å¸Œæœ›**ç¦æ­¢åŠ¨æ€æ·»åŠ å±æ€§**ï¼ˆæå‡æ€§èƒ½ + é˜²æ­¢è¯¯ç”¨ï¼‰ï¼Œå¯ä»¥ç”¨ `__slots__`ï¼š

class StrictContact:
    __slots__ = ("_name", "_phone", "_created_at") #åªå…è®¸åˆ›å»ºè¿™ä¸‰ä¸ªå±æ€§

    def __init__(self, name, phone = None, created_at = None):
        self._name = name
        self._phone = phone
        self._created_at = datetime.now().isoformat()
sc = StrictContact("å°æ˜")
# sc.age = 29 # AttributeError: 'StrictContact' object has no attribute 'age' and no __dict__ for setting new attributes

# âœ… `__slots__` ä¼šï¼š
# - ç¦æ­¢ `__dict__`ï¼ˆèŠ‚çœå†…å­˜ï¼‰
# - åªå…è®¸é¢„å®šä¹‰çš„å±æ€§
# - å¸¸ç”¨äºé«˜æ€§èƒ½æˆ–åµŒå…¥å¼åœºæ™¯    
# âœ… å°ç»“ï¼š`__dict__` ä¸åŠ¨æ€å±æ€§æ ¸å¿ƒè¦ç‚¹
# | æ¦‚å¿µ                   | è¯´æ˜                                                        |
# | ---------------------- | ----------------------------------------------------------- |
# | **`obj.__dict__`**     | å¯¹è±¡çš„å±æ€§å­—å…¸ï¼Œå­˜å‚¨æ‰€æœ‰å®ä¾‹å˜é‡                            |
# | **åŠ¨æ€æ·»åŠ **           | `obj.new_attr = value` æˆ– `setattr(obj, 'new_attr', value)` |
# | **åŠ¨æ€è¯»å–**           | `getattr(obj, 'attr', default)`ï¼ˆå®‰å…¨ï¼ï¼‰                   |
# | **`@property` ä¼˜å…ˆçº§** | å®ä¾‹å±æ€§ä¼šè¦†ç›–åŒåçš„ `@property`ï¼ˆå±é™©ï¼ï¼‰                  |
# | **`__slots__`**        | ç¦æ­¢åŠ¨æ€å±æ€§ï¼Œæå‡æ€§èƒ½å’Œå®‰å…¨æ€§                              |

# åŠ¨æ‰‹ç»ƒä¹ ï¼šç”¨ `__dict__` å®ç° `to_dict()`
# ç»™ä½ çš„ `Contact` ç±»åŠ ä¸€ä¸ªæ–¹æ³•ï¼ŒæŠŠå¯¹è±¡è½¬æˆå­—å…¸ï¼ˆå¸¸ç”¨äº API è¿”å›ï¼‰ï¼š
print("to_dict():",c1.to_dict())
print("__dict__:",c1.__dict__)
print("to_dict_dynamic():",c1.to_dict_dynamic())

